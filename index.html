<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Productos en Ferretería</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .contenedor {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
        }
        .logo {
            height: 50px;
        }
        .Menu2 {
            display: flex;
            gap: 20px;
        }
        #crud-form {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <header class="cabecera">
        <section id="texto1">
            <div class="contenedor">
                <a href="index.html" title="Página de inicio">
                </a>
            </div>
        </section>
    </header>
    <h1>Gestión de Productos en Ferretería</h1>
    <form id="crud-form">
        <label for="nombre">Nombre del Producto:</label>
        <input type="text" id="nombre"><br><br>
        <label for="categoria">Categoría:</label>
        <input type="text" id="categoria"><br><br>
        <label for="marca">Marca:</label>
        <input type="text" id="marca"><br><br>
        <label for="descripcion">Descripción:</label>
        <textarea id="descripcion" rows="1"></textarea><br><br>
        <label for="precio">Precio:</label>
        <input type="number" id="precio" min="0" step="0.01" required><br><br>
        <label for="cantidad">Cantidad en Stock:</label>
        <input type="number" id="cantidad" min="0" required><br><br>
        <button type="button" onclick="agregarProducto()">Agregar Producto</button>
        <button type="button" onclick="editarProducto()">Editar Producto</button>
        <button type="button" onclick="eliminarProducto()">Eliminar Producto</button>
    </form>

    <table>
        <thead>
           
        </thead>
        <tbody id="tabla-body"></tbody>
    </table>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
    import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js";

    // Your web app's Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyBB4VLEuWx4O57s4dfu9ii0BWLWJT33x58",
        authDomain: "proyectofari.firebaseapp.com",
        databaseURL: "https://proyectofari-default-rtdb.firebaseio.com",
        projectId: "proyectofari",
        storageBucket: "proyectofari.appspot.com",
        messagingSenderId: "538414020531",
        appId: "1:538414020531:web:08051bd59c98626d6a3dc6"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);

    // Mueve la declaración fuera del bloque DOMContentLoaded
    function agregarProducto() {
        const nombre = document.getElementById("nombre").value;
        const categoria = document.getElementById("categoria").value;
        const marca = document.getElementById("marca").value;
        const descripcion = document.getElementById("descripcion").value;
        const precio = document.getElementById("precio").value;
        const cantidad = document.getElementById("cantidad").value;

        push(
            ref(database, 'productos'),
            {
                nombre: nombre,
                categoria: categoria,
                marca: marca,
                descripcion: descripcion,
                precio: precio,
                cantidad: cantidad
            }
        );
    }

    document.addEventListener('DOMContentLoaded', () => {
        const btnAgregar = document.getElementById('btnAgregar');
        btnAgregar.addEventListener('click', agregarProducto);

        onValue(ref(database, 'productos'), (snapshot) => {
            renderizarTabla(snapshot.val());
        });
    });

    function renderizarTabla(productos) {
        const tablaBody = document.getElementById('tabla-body');
        tablaBody.innerHTML = "";

        for (const key in productos) {
            if (Object.hasOwnProperty.call(productos, key)) {
                const producto = productos[key];

                const fila = document.createElement('tr');
                fila.innerHTML = `
                    <td>${producto.nombre}</td>
                    <td>${producto.categoria}</td>
                    <td>${producto.marca}</td>
                    <td>${producto.descripcion}</td>
                    <td>${producto.precio}</td>
                    <td>${producto.cantidad}</td>
                    <td>
                        <button data-key="${key}" class="editar-btn">Editar</button>
                        <button data-key="${key}" class="eliminar-btn">Eliminar</button>
                    </td>
                `;

                fila.querySelector('.editar-btn').addEventListener('click', editarProducto);
                fila.querySelector('.eliminar-btn').addEventListener('click', eliminarProducto);

                tablaBody.appendChild(fila);
            }
        }
    }

    function editarProducto(event) {
        const key = event.target.dataset.key;
        const productoRef = ref(database, `productos/${key}`);
        onValue(productoRef, (snapshot) => {
            const producto = snapshot.val();

            document.getElementById('nombre').value = producto.nombre;
            document.getElementById('categoria').value = producto.categoria;
            document.getElementById('marca').value = producto.marca;
            document.getElementById('descripcion').value = producto.descripcion;
            document.getElementById('precio').value = producto.precio;
            document.getElementById('cantidad').value = producto.cantidad;
        });
    }

    function eliminarProducto(event) {
        const key = event.target.dataset.key;
        const productoRef = ref(database, `productos/${key}`);
        remove(productoRef);
    }
</script>
</body>
</html>
